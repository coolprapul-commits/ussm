<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
<title>Service Status Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
    /* Modern animated background */
    body {
        min-height: 100vh;
        background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
        font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
        position: relative;
        overflow-x: hidden;
    }
    body::before {
        content: '';
        position: fixed;
        top: -10%; left: -10%;
        width: 120vw; height: 120vh;
        background: radial-gradient(circle at 20% 30%, #3a7bd5 0%, transparent 60%),
                                radial-gradient(circle at 80% 70%, #00d2ff 0%, transparent 60%),
                                radial-gradient(circle at 60% 10%, #b8c6db 0%, transparent 70%);
        opacity: 0.25;
        z-index: 0;
        animation: bgmove 18s linear infinite alternate;
        pointer-events: none;
    }
    @keyframes bgmove {
        0% { transform: scale(1) translateY(0); }
        100% { transform: scale(1.1) translateY(30px); }
    }

    .navbar {
        border-radius: 1.5rem;
        margin: 1.5rem auto 2rem auto;
        max-width: 1200px;
        box-shadow: 0 4px 32px #3a7bd522;
        background: rgba(255,255,255,0.85) !important;
        backdrop-filter: blur(6px);
        position: relative;
    }
    .navbar-brand {
        font-size: 1.7rem;
        letter-spacing: 0.5px;
    }
    .logout-btn {
        position: absolute;
        right: 2rem;
        top: 50%;
        transform: translateY(-50%);
        font-weight: 500;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px #e74c3c22;
    }
    @media (max-width: 768px) {
        .logout-btn { position: static; width: 100%; margin-bottom: 1rem; transform: none; }
    }

    .container {
        max-width: 1200px;
        z-index: 1;
        position: relative;
    }
    .search-bar { max-width: 320px; border-radius: 1.5rem; }
    .form-select, .form-control { border-radius: 1.5rem; }

    .card {
  /* Floating Add Service Button */
  .add-service-fab {
  position: fixed;
  left: 50%;
  bottom: 2.2rem;
  transform: translateX(-50%);
  z-index: 1000;
    border-radius: 2rem;
    min-width: 160px;
    height: 48px;
    box-shadow: 0 4px 18px #3a7bd544;
    font-size: 1.15rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 1.5rem;
    font-weight: 600;
    background: linear-gradient(90deg, #3a7bd5, #00d2ff);
    color: #fff;
    border: none;
    transition: box-shadow 0.2s, background 0.2s;
    cursor: pointer;
    gap: 0.7em;
  }
  .add-service-fab:hover {
    background: linear-gradient(90deg, #245ea8, #3a7bd5);
    color: #fff;
    box-shadow: 0 8px 32px #3a7bd544;
  }
  @media (max-width: 600px) {
    .add-service-fab {
      min-width: 120px;
      height: 40px;
      font-size: 1em;
      bottom: 1rem;
    }
  }
    border: none;
    border-radius: 1.5rem;
    background: rgba(255,255,255,0.75);
    box-shadow: 0 6px 32px #3a7bd522, 0 1.5px 6px #b8c6db33;
    transition: box-shadow 0.2s, transform 0.2s;
    margin-bottom: 1.5rem;
    backdrop-filter: blur(4px);
  }

  /* Shrink analytics card and pie chart */
  .analytics-card {
    max-width: 260px;
    margin-left: auto;
    margin-right: 0;
    padding: 1.1rem 1rem 0.7rem 1rem;
  }
  #statusPieChart {
    max-width: 180px;
    max-height: 180px;
    margin: 0 auto;
    display: block;
  }
  @media (max-width: 991px) {
    .analytics-card { max-width: 100%; margin: 0 auto 1rem auto; }
    #statusPieChart { max-width: 140px; max-height: 140px; }
  }
  .card:hover {
      box-shadow: 0 8px 40px #3a7bd544, 0 2px 8px #b8c6db44;
      transform: translateY(-2px) scale(1.015);
  }
    .card-title {
        font-weight: 700;
        font-size: 1.2rem;
        color: #232a34;
        letter-spacing: 0.2px;
    }
    .card-subtitle {
        color: #3a7bd5;
        font-weight: 500;
        font-size: 1rem;
    }
    .status-badge {
        font-weight: 600;
        border-radius: 1rem;
        padding: 0.3em 1.1em;
        font-size: 1em;
        box-shadow: 0 1px 6px #b8c6db33;
        margin-top: 0.5em;
        display: inline-block;
    }
    .status-operational { background: linear-gradient(90deg, #2ecc40, #27ae60); color: #fff; }
    .status-partial { background: linear-gradient(90deg, #f1c40f, #f39c12); color: #232a34; }
    .status-down { background: linear-gradient(90deg, #e74c3c, #c0392b); color: #fff; }

    .modal-content {
        border-radius: 1.2rem;
        box-shadow: 0 4px 32px #3a7bd522;
        background: rgba(255,255,255,0.97);
        backdrop-filter: blur(4px);
    }
    .modal-title {
        font-weight: 700;
        color: #3a7bd5;
    }
    .btn-primary, .btn-success, .btn-secondary {
        border-radius: 1.5rem;
        font-weight: 600;
        letter-spacing: 0.2px;
        box-shadow: 0 2px 8px #3a7bd522;
    }
    .btn-outline-primary {
        border-radius: 1.5rem;
        font-weight: 600;
        letter-spacing: 0.2px;
    }
    .form-label {
        font-weight: 500;
        color: #3a7bd5;
    }
    .form-check-label {
        font-weight: 500;
        color: #232a34;
    }
    .fa-server {
        filter: drop-shadow(0 2px 8px #3a7bd522);
    }
    .fa-edit {
        color: #3a7bd5;
    }
    /* Subtle fade-in for cards */
    #serviceCards > div {
        animation: fadein 0.7s cubic-bezier(.39,.575,.565,1) both;
    }
    @keyframes fadein {
        0% { opacity: 0; transform: translateY(20px) scale(0.98); }
        100% { opacity: 1; transform: none; }
    }

  /* Sticky vertical Add Service Button */
.add-service-fab {
      position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  padding: 12px 24px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  transition: none; /* no hover transitions */
}

@media (max-width: 600px) {
    .add-service-fab {
        min-width: 120px;
        height: 40px;
        font-size: 1em;
        bottom: 1rem;
    }
}
  @media (max-width: 600px) {
    .add-service-fab {
      min-width: 36px;
      height: 120px;
      font-size: 0.98em;
      padding: 0 0.2rem;
    }
  }
  </style>
</head>
<body>
  <nav class="navbar navbar-light bg-white shadow-sm mb-4">
    <div class="container-fluid py-2 d-flex align-items-center justify-content-between" style="min-height: 48px; max-width: 1200px;">
      <span class="navbar-brand mb-0 h1 d-flex align-items-center">
        <i class="fa fa-server me-2 text-primary" style="font-size: 2rem;"></i>
        <span style="background: linear-gradient(90deg, #3a7bd5, #00d2ff); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">
          Service Status Dashboard
        </span>
      </span>
      <div class="d-flex align-items-center gap-3" style="gap: 1.25rem !important;">
        <span id="roleLabel" class="badge bg-primary text-light fs-6 px-3 py-2" style="letter-spacing:0.5px; font-size:1.08rem;">Role</span>
        <button class="btn btn-outline-danger logout-btn ms-2" style="position:static;transform:none;" id="logoutBtn">Logout</button>
        <script>
          document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('ussm_role');
            window.location.href = 'index.html';
          });
        </script>
        
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row mb-4 align-items-center">
      <div class="col-lg-8 col-md-7 col-12 mb-3 mb-md-0 d-flex flex-wrap gap-3 align-items-end">
        <input id="searchInput" class="form-control search-bar" placeholder="Search by name..." style="max-width: 320px;">
        <select id="statusFilter" class="form-select" style="max-width: 200px;">
          <option value="">All Statuses</option>
          <option value="Operational">Operational</option>
          <option value="Partial Outage">Partial Outage</option>
          <option value="Down">Down</option>
        </select>
        <button class="btn btn-secondary" id="customizeBtn"><i class="fa fa-sliders me-1"></i> Customize My Dashboard</button>
        <button class="btn btn-outline-primary" id="exportJsonBtn" title="Export as JSON"><i class="fa fa-file-code"></i> Export JSON</button>
        <button class="btn btn-outline-success" id="exportExcelBtn" title="Export as Excel"><i class="fa fa-file-excel"></i> Export Excel</button>
        <!-- Add Service button moved to floating FAB below -->
      </div>
      <div class="col-lg-4 col-md-5 col-12 mb-3 mb-md-0">
        <div class="card analytics-card p-2 shadow-sm" style="background:rgba(255,255,255,0.92);">
          <div class="fw-bold mb-2 text-center" style="color:#3a7bd5; font-size:1.05rem;">Service Status Analytics</div>
          <canvas id="statusPieChart" height="120"></canvas>
        </div>
      </div>
    </div>
  <div class="row" id="serviceCards"></div>
</div>

<!-- Floating Add Service Button (FAB) for admin/developer only -->
<button class="add-service-fab shadow-lg" id="addServiceBtn"
  title="Add Service" aria-label="Add Service" tabindex="0" style="display:none;" class="add-service-fab" id="addServiceBtn">
  <span style="font-size:1.1em; font-weight:600;">Add Service</span>
  </button>

  <!-- Add/Edit Service Modal -->
  <div class="modal fade" id="serviceModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="serviceForm">
          <div class="modal-header">
            <h5 class="modal-title" id="serviceModalTitle">Add/Edit Service</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="serviceName" class="form-label">Service Name</label>
              <input type="text" class="form-control" id="serviceName" required>
            </div>
            <div class="mb-3">
              <label for="serviceType" class="form-label">Type</label>
              <select class="form-select" id="serviceType" required>
                <option value="Internal">Internal</option>
                <option value="External">External</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="serviceStatus" class="form-label">Status</label>
              <select class="form-select" id="serviceStatus" required>
                <option value="Operational">Operational</option>
                <option value="Partial Outage">Partial Outage</option>
                <option value="Down">Down</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Customize Dashboard Modal -->
  <div class="modal fade" id="customizeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="customizeForm">
          <div class="modal-header">
            <h5 class="modal-title">Customize My Dashboard</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="customizeList">
            <!-- Service checkboxes will be rendered here -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="dashboard.js"></script>
  <script>
    // Role-based UI logic
    let role = localStorage.getItem('ussm_role');
    if (!role) role = 'user';
    let roleLabel = '';
    if (role === 'admin') roleLabel = 'Admin';
    else if (role === 'developer') roleLabel = 'Developer';
    else roleLabel = 'User';
    document.getElementById('roleLabel').textContent = roleLabel;
    // Show Add Service button only for admin/developer (floating FAB)
    var addBtn = document.getElementById('addServiceBtn');
    if (role === 'admin' || role === 'developer') {
      addBtn.style.display = '';
    } else {
      addBtn.style.display = 'none';
    }
    // Logout is handled in dashboard.js
  </script>
  <!-- Chart rendering is handled in dashboard.js. No inline chart logic here. -->
</body>
</html>
